<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Shuffle Mirror</title>
<style>
  body { font-family: sans-serif; background: #111; color: #eee; text-align: center; }
  canvas { margin-top: 15px; background: #fff; }
  button { margin: 10px; padding: 10px 20px; font-size: 16px; }
</style>
</head>
<body>

<h1>Shuffle Mirror Effect</h1>
<input type="file" id="upload" accept="image/*">
<button id="shuffleBtn" disabled>Shuffle</button>
<br>
<canvas id="canvas"></canvas>

<script>
const upload = document.getElementById('upload');
const shuffleBtn = document.getElementById('shuffleBtn');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let img = new Image();
let tempCanvas = document.createElement('canvas');
let tctx = tempCanvas.getContext('2d');

upload.addEventListener('change', () => {
    const file = upload.files[0];
    if (!file) return;
    img.src = URL.createObjectURL(file);
});

img.onload = () => {
    // Fit canvas to image
    canvas.width = img.width;
    canvas.height = img.height;
    tempCanvas.width = img.width;
    tempCanvas.height = img.height;

    // Draw the original image
    ctx.drawImage(img, 0, 0);
    shuffleBtn.disabled = false;
};

// Randomly mirror (horizontal, vertical, both, or none)
function shuffleMirror() {
    const w = canvas.width;
    const h = canvas.height;

    // Copy original image into temp canvas
    tctx.clearRect(0, 0, w, h);
    tctx.drawImage(canvas, 0, 0);

    // Clear visible canvas
    ctx.clearRect(0, 0, w, h);

    // Random flip selection: 0=none,1=H,2=V,3=both
    const mode = Math.floor(Math.random() * 4);

    ctx.save();

    // Horizontal flip
    if (mode === 1) {
        ctx.translate(w, 0);
        ctx.scale(-1, 1);
    }
    // Vertical flip
    else if (mode === 2) {
        ctx.translate(0, h);
        ctx.scale(1, -1);
    }
    // Horizontal + Vertical flip
    else if (mode === 3) {
        ctx.translate(w, h);
        ctx.scale(-1, -1);
    }

    // Draw the flipped or original image
    ctx.drawImage(tempCanvas, 0, 0);

    ctx.restore();
}

shuffleBtn.addEventListener('click', shuffleMirror);
</script>
</body>
</html>
